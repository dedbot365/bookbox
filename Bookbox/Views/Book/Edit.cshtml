@model Bookbox.DTOs.BookDTO

@{
    ViewData["Title"] = "Edit Book";
}

<div class="container-fluid mt-4">
    <h1 class="h3 mb-2 text-gray-800">Edit Book</h1>
    <p class="mb-4">Update book information in the catalog.</p>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold">Book Information</h6>
        </div>
        <div class="card-body">
            <form asp-action="Edit" method="post" enctype="multipart/form-data">
                <input type="hidden" name="id" value="@ViewContext.RouteData.Values["id"]" />
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="Title" class="form-label">Title</label>
                            <input asp-for="Title" class="form-control" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Author" class="form-label">Author</label>
                            <input asp-for="Author" class="form-control" />
                            <span asp-validation-for="Author" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Genre" class="form-label">Genre</label>
                            <select asp-for="Genre" class="form-select" asp-items="Html.GetEnumSelectList<Bookbox.Constants.Genre>()">
                                <option value="">Select Genre</option>
                            </select>
                            <span asp-validation-for="Genre" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Price" class="form-label">Price</label>
                            <input asp-for="Price" class="form-control" type="number" step="0.01" min="0" />
                            <span asp-validation-for="Price" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Format" class="form-label">Format</label>
                            <input asp-for="Format" class="form-control" />
                            <span asp-validation-for="Format" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Publisher" class="form-label">Publisher</label>
                            <input asp-for="Publisher" class="form-control" />
                            <span asp-validation-for="Publisher" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="ISBN" class="form-label">ISBN</label>
                            <input asp-for="ISBN" class="form-control" />
                            <span asp-validation-for="ISBN" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">Description</label>
                            <textarea asp-for="Description" class="form-control" rows="6"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Stock" class="form-label">Stock</label>
                            <input asp-for="Stock" class="form-control" type="number" min="0" />
                            <span asp-validation-for="Stock" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Language" class="form-label">Language</label>
                            <input asp-for="Language" class="form-control" />
                            <span asp-validation-for="Language" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="Awards" class="form-label">Awards</label>
                            <input asp-for="Awards" class="form-control" />
                            <span asp-validation-for="Awards" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="PhysicalStock" class="form-label">Physical Stock</label>
                            <input asp-for="PhysicalStock" class="form-control" type="number" min="0" />
                            <span asp-validation-for="PhysicalStock" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="ImageFile" class="form-label">Cover Image</label>
                            <input asp-for="ImageFile" class="form-control" type="file" accept=".jpg,.jpeg,.png,.gif" />
                            <span asp-validation-for="ImageFile" class="text-danger"></span>
                            <div class="form-text">Maximum size: 5MB. Supported formats: JPG, JPEG, PNG, GIF.</div>
                            
                            @if (!string.IsNullOrEmpty(ViewData["CurrentImageUrl"]?.ToString()))
                            {
                                <div class="mt-3">
                                    <p>Current Image:</p>
                                    <div id="currentImageContainer" class="mt-2 text-center">
                                        <img src="@ViewData["CurrentImageUrl"]" alt="Current cover" 
                                             style="max-height: 200px; max-width: 100%;" class="img-thumbnail" />
                                    </div>
                                    <div class="form-text mt-1">Select a new image to replace the current one.</div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between mt-4">
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            // Preview image when selected
            $("#ImageFile").change(function () {
                if (this.files && this.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        // Create or update the preview
                        if ($("#imagePreview").length === 0) {
                            $("<div id='previewContainer' class='mt-3 text-center'><p>New Image Preview:</p><img id='imagePreview' src='" + 
                              e.target.result + "' style='max-height: 200px; max-width: 100%;' class='img-thumbnail' /></div>")
                                .insertAfter("#currentImageContainer");
                        } else {
                            $("#imagePreview").attr("src", e.target.result);
                        }
                    };
                    reader.readAsDataURL(this.files[0]);
                }
            });
        });
    </script>
}